<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <title>Handouts Digital</title>

  <style>
    /* dynamische vh fallback */
    :root { --vh: 1vh; }

    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: rgba(0,0,0,0.1); }

    /* Body: nicht zentrieren — lässt Scrollverhalten normal funktionieren */
    html, body {
      height: 100%;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', system-ui, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 0;
      -webkit-text-size-adjust: 100%;
      touch-action: manipulation;
      /* kein overflow:hidden mehr! */
      overflow: auto;
      -webkit-overflow-scrolling: touch;
    }

    /* App-Container verwendet dynamische Höhe */
    .container {
      width: 100%;
      max-width: 600px;
      height: calc(var(--vh, 1vh) * 100); /* <-- dynamisch */
      background: #ffffff;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      position: relative;
      display: flex;
      flex-direction: column;
      border: none;
      overflow: hidden; /* innere Bereiche scrollen, nicht das ganze Dokument */
      margin: 0 auto;
    }

    /* Safe-area und Abstand am Ende */
    .category-grid,
    .viewer-container {
      padding-bottom: calc(20px + env(safe-area-inset-bottom, 0px));
      min-height: 0; /* wichtig für flex children, damit overflow-y funktioniert */
    }

    .image-viewer,
    .navigation {
      padding-bottom: calc(8px + env(safe-area-inset-bottom, 0px));
    }

    .home-button { position: absolute; top: 20px; left: 20px; width: 50px; height: 50px; background: #f0f0f0; border: 1px solid #d0d0d0; border-radius: 12px; display:flex; align-items:center; justify-content:center; z-index:10; cursor:pointer; user-select:none; -webkit-user-select:none; touch-action: manipulation; }

    .title { text-align:center; color:#333; font-size:28px; font-weight:700; margin-top:20px; margin-bottom:20px; padding:0 80px; text-transform:uppercase; letter-spacing:3px; line-height:1.3; }

    /* LISTEN / SCROLLAREAS - stellen das eigentliche Scrollen sicher */
    .category-grid {
      display: flex;
      flex-direction: column;
      gap: 30px;
      margin-top: 30px;
      overflow-y: auto;      /* <-- wichtig */
      flex: 1;               /* füllt verbleibenden Platz */
      padding-right: 10px;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .category-button, .handout-button {
      background:#f0f0f0; border:1px solid #d0d0d0; border-radius:16px; padding:28px 24px; font-size:18px; font-weight:700; color:#333; cursor:pointer; box-shadow:0 2px 4px rgba(0,0,0,0.1); text-transform:uppercase; letter-spacing:1.5px; user-select:none; -webkit-user-select:none; touch-action: manipulation;
    }

    .viewer-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      margin-top: 70px;
      flex: 1;
      overflow-y: auto;       /* <-- vorher hidden, jetzt scrollbar möglich */
      justify-content: flex-start;
      min-height: 0;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    /* Scrollbar verstecken – Chrome / Safari / Edge */
    .category-grid::-webkit-scrollbar,
    .viewer-container::-webkit-scrollbar {
      display: none;
    }

    /* Bild-Viewer begrenzen relativ zur dynamischen VH */
    .image-viewer {
      width: 100%;
      background: #f8f8f8;
      border-radius: 12px;
      border: 1px solid #e0e0e0;
      overflow: hidden;
      position: relative;
      max-height: calc(var(--vh, 1vh) * 100 - 200px); /* passt sich an */
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 1;
    }

    .image-viewer img { max-width:100%; max-height:100%; width:auto; height:auto; display:block; object-fit:contain; cursor:zoom-in; user-select:none; -webkit-user-select:none; -webkit-touch-callout:none; }

    .image-viewer.zoomed { overflow: auto; }
    .image-viewer.zoomed img { cursor: zoom-out; transform: scale(2); transform-origin: top left; }

    .navigation { display:flex; gap:15px; align-items:center; margin-top:15px; flex-shrink:0; }

    .nav-button { width:60px; height:60px; background:#f0f0f0; border:1px solid #d0d0d0; border-radius:12px; display:flex; align-items:center; justify-content:center; cursor:pointer; box-shadow:0 2px 4px rgba(0,0,0,0.1); user-select:none; -webkit-user-select:none; touch-action: manipulation; }

    .page-indicator { background:#f0f0f0; border:1px solid #d0d0d0; padding:12px 24px; border-radius:24px; font-weight:600; color:#333; box-shadow:0 2px 4px rgba(0,0,0,0.1); font-size:16px; }

    .error-message { padding:20px; text-align:center; color:#ff6b6b; font-weight:600; line-height:1.8; }

    .loading { text-align:center; padding:20px; color:#333; font-weight:600; }

    /* Responsive Anpassungen - nur VH-Referenzen durch var(--vh) ersetzt */
    @media (max-width: 640px) {
      .container { padding:10px; max-width: 100%; }
      .title { font-size:18px; padding:0 60px; letter-spacing:1px; margin-bottom:15px; margin-top:15px; }
      .category-button, .handout-button { font-size:15px; padding:20px 16px; border-radius:12px; }
      .category-grid { gap:12px; margin-top:20px; padding-right:5px; }
      .home-button { width:44px; height:44px; top:15px; left:15px; border-radius:10px; }
      .viewer-container { gap:10px; margin-top:55px; }
      .image-viewer { border-radius:8px; max-height: calc(var(--vh, 1vh) * 100 - 160px); }
      .navigation { gap:10px; margin-top:10px; width:100%; justify-content:center; }
      .nav-button { width:50px; height:50px; border-radius:10px; }
      .page-indicator { padding:10px 20px; font-size:14px; border-radius:20px; flex:1; max-width:160px; text-align:center; }
    }

    @media (max-width: 380px) {
      .title { font-size:16px; padding:0 55px; }
      .category-button, .handout-button { font-size:14px; padding:18px 14px; }
      .page-indicator { font-size:13px; padding:8px 16px; }
      .image-viewer { max-height: calc(var(--vh,1vh) * 100 - 150px); }
    }
  </style>
</head>
<body>
  <div class="container" id="app"></div>

  <!-- React / App-Skript (unverändert) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState } = React;

    const categoriesConfig = {
      'unterhaltung': { title: 'UNTERHALTNG', handouts: [{ id: 'ard-audiothek', title:'ARD Audiothek' }, { id: 'spotify', title:'Spotify' }]},
      'digitaler-alltag': { title: 'DIGITALER ALLTAG', handouts: [
        {id:'notfallpass-android', title:'Notfallpass Android'},
        {id:'notfallpass-iphone', title:'Notfallpass iPhone'},
        {id:'online-banking', title:'Online Banking'},
        {id:'db-app', title:'DB App'},
        {id:'lieferdienste', title:'Lieferdienste'},
        {id:'online-shops', title:'Online Shops'},
        {id:'flaschenpost', title:'Flaschenpost'},
        {id:'doctolib', title:'Doctolib'},
        {id:'payback-app', title:'Payback App'},
        {id:'mytherapy', title:'MyTherapy'},
        {id:'e-rezept-gesundde', title:'E-Rezept - Gesund.de'}
      ]},
      'sicherheit': { title: 'SICHERHEIT', handouts: [
        {id:'adblocker-antivirus', title:'Adblocker und Antivirus'},
        {id:'chrome-werbung-blockieren', title:'Chrome Werbung blockieren'},
        {id:'samsung-browser-werbung-blockieren', title:'Samsung Browser Werbung blockieren'},
        {id:'xiaomi-werbung', title:'Xiaomi Werbung'},
        {id:'safari-einstellungen', title:'Safari Einstellungen'},
        {id:'online-betrug', title:'Online-Betrug'},
        {id:'passwortmanager', title:'Passwortmanager Handout'}
      ]},
      'handy-grundlagen': { title:'HANDY GRUNDLAGEN', handouts: [
        {id:'e-mails', title:'E-Mails lesen und schreiben'},
        {id:'fotos-whatsapp', title:'Fotos versenden WhatsApp'},
        {id:'kalendereintrag', title:'Kalendereintrag'},
        {id:'loeschungen-android', title:'Löschungen auf dem Android'},
        {id:'updates-handy', title:'Updates auf dem Handy installieren'},
        {id:'app-installieren-android', title:'App Installieren Android'},
        {id:'qr-code-android', title:'QR-Code Android'},
        {id:'qr-code-ios', title:'QR-Code iOS'},
        {id:'loeschungen-iphone', title:'Löschungen auf einem iPhone durchführen'},
        {id:'datenuebertragung-android', title:'Datenübertragung Android'},
        {id:'datenuebertragung-android-kurz', title:'Datenübertragung Android Einfach'},
        {id:'datenuebertragung-iphone', title:'Datenübertragung iPhone'},
        {id:'datenuebertragung-vergleich', title:'Datenübertragung Android vs iPhone'}
      ]}
    };

    const HomeIcon = () => (<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>);
    const ArrowLeft = () => (<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>);
    const ArrowRight = () => (<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>);

    function App(){
      const [view, setView] = useState('categories');
      const [selectedCategory, setSelectedCategory] = useState(null);
      const [selectedHandout, setSelectedHandout] = useState(null);
      const [currentPage, setCurrentPage] = useState(0);
      const [isZoomed, setIsZoomed] = useState(false);
      const [availablePages, setAvailablePages] = useState([]);
      const [imageError, setImageError] = useState(false);
      const [isLoading, setIsLoading] = useState(false);

      const goHome = () => { setView('categories'); setSelectedCategory(null); setSelectedHandout(null); setCurrentPage(0); setIsZoomed(false); setAvailablePages([]); };
      const goBackToCategory = () => { setView('handouts'); setSelectedHandout(null); setCurrentPage(0); setIsZoomed(false); setAvailablePages([]); };
      const selectCategory = (categoryId) => { setSelectedCategory(categoryId); setView('handouts'); };
      const selectHandout = async (handout, categoryId) => {
        setIsLoading(true);
        setSelectedHandout({ ...handout, categoryId });
        setCurrentPage(0);
        setView('viewer');
        setIsZoomed(false);
        const pages = await loadAvailablePages(categoryId, handout.id);
        setAvailablePages(pages);
        setIsLoading(false);
      };

      const loadAvailablePages = async (categoryId, handoutId) => {
        const extensions = ['jpg','jpeg','png'];
        const foundPages = [];
        for (let i=1;i<=20;i++){
          let pageFound = false;
          for (let ext of extensions){
            const filename = `bilder/${categoryId}_${handoutId}_${i}.${ext}`;
            try {
              const exists = await checkImageExists(filename);
              if (exists) { foundPages.push(filename); pageFound = true; break; }
            } catch(e){}
          }
          if (!pageFound) break;
        }
        return foundPages;
      };

      const checkImageExists = (url) => new Promise((resolve)=>{
        const img = new Image();
        const timeout = setTimeout(()=>{ img.src=''; resolve(false); }, 3000);
        img.onload = ()=>{ clearTimeout(timeout); resolve(true); };
        img.onerror = ()=>{ clearTimeout(timeout); resolve(false); };
        img.src = url;
      });

      const nextPage = ()=>{ if (currentPage < availablePages.length -1){ setCurrentPage(currentPage+1); setIsZoomed(false); setImageError(false);} };
      const prevPage = ()=>{ if (currentPage > 0){ setCurrentPage(currentPage-1); setIsZoomed(false); setImageError(false);} };
      const toggleZoom = ()=>{ if (!imageError) setIsZoomed(!isZoomed); };
      const handleImageError = ()=> setImageError(true);
      const handleImageLoad = ()=> setImageError(false);

      return (
        <>
          {view === 'handouts' && (<button className="home-button" onClick={goHome}><ArrowLeft /></button>)}
          {view === 'viewer'   && (<button className="home-button" onClick={goBackToCategory}><ArrowLeft /></button>)}

          {view === 'categories' && (
            <>
              <h1 className="title">Kategorien</h1>
              <div className="category-grid">
                {Object.keys(categoriesConfig).map(categoryId => (
                  <button key={categoryId} className="category-button" onClick={()=>selectCategory(categoryId)}>
                    {categoriesConfig[categoryId].title}
                  </button>
                ))}
              </div>
            </>
          )}

          {view === 'handouts' && selectedCategory && (
            <>
              <h1 className="title">{categoriesConfig[selectedCategory].title}</h1>
              <div className="category-grid">
                {categoriesConfig[selectedCategory].handouts.map((handout, index)=>(
                  <button key={index} className="handout-button" onClick={()=>selectHandout(handout, selectedCategory)}>{handout.title}</button>
                ))}
              </div>
            </>
          )}

          {view === 'viewer' && selectedHandout && (
            <div className="viewer-container">
              {isLoading ? <div className="loading">Lade Bilder...</div> :
               availablePages.length === 0 ? (
                 <div className="error-message">
                   ❌ Keine Bilder gefunden<br/><br/>
                   Erwarteter Pfad:<br/>
                   <strong style={{color:'#333', fontSize:'14px', display:'inline-block', marginTop:'10px', padding:'8px 16px', background:'#f0f0f0', borderRadius:'8px', border:'1px solid #d0d0d0'}}>
                     bilder/{selectedHandout.categoryId}_{selectedHandout.id}_1.jpg
                   </strong>
                   <br/><br/>
                   <span style={{fontSize:'14px', color:'#666'}}>Erstellen Sie einen Ordner "bilder" neben der HTML-Datei und legen Sie dort Ihre Bilder ab.</span>
                 </div>
               ) : (
                 <>
                   <div className={`image-viewer ${isZoomed ? 'zoomed' : ''}`}>
                     {imageError ? <div className="error-message">Bild konnte nicht geladen werden</div> :
                       <img src={availablePages[currentPage]} alt={`Schritt ${currentPage+1}`} onClick={toggleZoom} onError={handleImageError} onLoad={handleImageLoad} />}
                   </div>
                   <div className="navigation">
                     <button className="nav-button" onClick={prevPage} disabled={currentPage===0}><ArrowLeft /></button>
                     <div className="page-indicator">Schritt {currentPage+1} von {availablePages.length}</div>
                     <button className="nav-button" onClick={nextPage} disabled={currentPage===availablePages.length-1}><ArrowRight /></button>
                   </div>
                 </>
               )}
            </div>
          )}
        </>
      );
    }

    ReactDOM.render(<App />, document.getElementById('app'));
  </script>

  <!-- dynamische --vh Variable setzen (für iOS/Android adressbar issues) -->
  <script>
    function setVhVar(){
      document.documentElement.style.setProperty('--vh', (window.innerHeight * 0.01) + 'px');
    }
    setVhVar();
    window.addEventListener('resize', setVhVar);
    window.addEventListener('orientationchange', setVhVar);
  </script>
</body>
</html>
